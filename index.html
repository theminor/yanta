<!DOCTYPE html>
<html lang="en">
<head>
	<title>yanta</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="manifest" href="manifest.json" crossOrigin="use-credentials">
	<link rel="icon" href="icons/yata-64.png">
	<link rel="stylesheet" href="index.css">
</head>
<body>
<div id="buttonRow">
	<input type="text" id="fileNameBox" oninput="fileNameChange()"></input>
	<button id="loadLocalBtn" class="buttonRowBtn" onClick="loadLocalBtn()">Load Local</button>
	<button id="saveLocalBtn" class="buttonRowBtn" onClick="saveLocalBtn()">Save Local</button>
	<button id="loadRemoteBtn" class="buttonRowBtn" onClick="loadRemoteBtn()">Load Remote</button>
	<button id="saveRemoteBtn" class="buttonRowBtn" onClick="saveRemoteBtn()">Save Remote</button>
</div>
<div id="editor"></div>
    
<script src="./ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="./theme-yanta.js" type="text/javascript" charset="utf-8"></script>
<script>
	function srvRqst(method, url, data) {
		return new Promise((resolve, reject) => {
			let rqst = new XMLHttpRequest();
			rqst.onreadystatechange = () => {
				if (rqst.readyState === XMLHttpRequest.DONE) {
					if (rqst.status === 200) resolve(rqst.responseText); else reject(rqst.status);
				}
			}
			rqst.ontimeout = () => reject('timeout');
			rqst.open(method, url, true);
			rqst.send(data);
		})
 	}
	
	var editor = ace.edit('editor');
	editor.setTheme('ace/theme/yanta');
	editor.session.setMode('ace/mode/markdown');
	editor.session.setTabSize(4);
	editor.session.setUseWrapMode(true);
	document.getElementById('editor').style.fontSize='16px';	
	document.getElementById('fileNameBox').value = document.cookie.match('(^|;)\\s*filename\\s*=\\s*([^;]+)');

	if('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
	function fileNameChange() { document.cookie = 'filename=' + document.getElementById('fileNameBox').value + '; expires=Sat, 31 Dec 2050 00:00:01 GMT'; }
	function saveLocalBtn() { localStorage.setItem('editorText', editor.getValue()); }
	async function loadLocalBtn() { editor.setValue(localStorage.getItem('editorText') || await srvRqst('GET', './default.txt'), -1); }
	async function saveRemoteBtn() { srvRqst('PUT', './docs/' + document.getElementById('fileNameBox').value, editor.getValue()); }		// // *** TO DO: multiple files and file names
	async function loadRemoteBtn() { editor.setValue(await srvRqst('GET', './docs/' + document.getElementById('fileNameBox').value) || await srvRqst('GET', './default.txt'), -1); }
	// loadBtn();
</script>

</body>
</html>
